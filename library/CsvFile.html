<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>F# Data: CSV Parser
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="The F# Data library implements type providers for working with structured file formats (CSV, HTML, JSON and XML) and for accessing the WorldBank data. It also includes helpers for parsing CSV, HTML and JSON files, and for sending HTTP requests.">
    <meta name="author" content="Tomas Petricek; Gustavo Guerra; Colin Bull">

    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">

    <link type="text/css" rel="stylesheet" href="/FSharp.Data/content/style.css" />
    <link type="text/css" rel="stylesheet" href="/FSharp.Data/content/fsdata.css" />
    <script type="text/javascript" src="/FSharp.Data/content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://fsharp.org">fsharp.org</a></li>
          <li><a href="http://fsprojects.github.io/FSharp.Data.Toolbox"><img height="16" width="16" src="http://fsharp.org/images/thumbs/FSharp.Data.Toolbox.png" /> F# Data Toolbox</a></li>
        </ul>
        <h3 class="muted"><a href="/FSharp.Data/index.html">F# Data</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h1>F# Data: CSV Parser</h1>
<p>The F# <a href="CsvProvider.html">CSV Type Provider</a> is built on top of an efficient CSV parser written
in F#. There's also a simple API that can be used to access values dynamically.</p>
<p>When working with well-defined CSV documents, it is easier to use the
<a href="CsvProvider.html">type provider</a>, but in a more dynamic scenario or when writing
quick and simple scripts, the parser might be a simpler option.</p>
<h2>Loading CSV documents</h2>
<p>To load a sample CSV document, we first need to reference the <code>FSharp.Data.dll</code> library
(when using F# Interactive) or to add reference to a project.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="pp">#r</span> <span class="s">&quot;../../../bin/lib/net45/FSharp.Data.dll&quot;</span>
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="id">FSharp</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="id">Data</span>
</code></pre></td>
</tr>
</table>
<p>The <code>FSharp.Data</code> namespace contains the <code>CsvFile</code> type that provides two static methods
for loading data. The <code>Parse</code> method can be used if we have the data in a <code>string</code> value.
The <code>Load</code> method allows reading the data from a file or from a web resource (and there's
also an asynchronous <code>AsyncLoad</code> version). The following sample calls <code>Load</code> with a URL that
points to a live CSV file on the Yahoo finance web site:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// Download the stock prices</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs3', 3)" onmouseover="showTip(event, 'fs3', 3)" class="id">msft</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs4', 4)" onmouseover="showTip(event, 'fs4', 4)" class="m">CsvFile</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs5', 5)" onmouseover="showTip(event, 'fs5', 5)" class="id">Load</span><span class="pn">(</span><span class="s">&quot;http://www.google.com/finance/historical?q=MSFT&amp;output=csv&quot;</span><span class="pn">)</span><span class="pn">.</span><span class="id">Cache</span><span class="pn">(</span><span class="pn">)</span>

<span class="c">// Print the prices in the HLOC format</span>
<span class="k">for</span> <span onmouseout="hideTip(event, 'fs6', 6)" onmouseover="showTip(event, 'fs6', 6)" class="id">row</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs3', 7)" onmouseover="showTip(event, 'fs3', 7)" class="id">msft</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs7', 8)" onmouseover="showTip(event, 'fs7', 8)" class="id">Rows</span> <span class="k">do</span>
  <span onmouseout="hideTip(event, 'fs8', 9)" onmouseover="showTip(event, 'fs8', 9)" class="fn">printfn</span> <span class="s">&quot;HLOC: (</span><span class="pf">%s</span><span class="s">, </span><span class="pf">%s</span><span class="s">, </span><span class="pf">%s</span><span class="s">)&quot;</span> 
    <span class="pn">(</span><span onmouseout="hideTip(event, 'fs6', 10)" onmouseover="showTip(event, 'fs6', 10)" class="fn">row</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs9', 11)" onmouseover="showTip(event, 'fs9', 11)" class="id">GetColumn</span> <span class="s">&quot;High&quot;</span><span class="pn">)</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs6', 12)" onmouseover="showTip(event, 'fs6', 12)" class="fn">row</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs9', 13)" onmouseover="showTip(event, 'fs9', 13)" class="id">GetColumn</span> <span class="s">&quot;Low&quot;</span><span class="pn">)</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs6', 14)" onmouseover="showTip(event, 'fs6', 14)" class="fn">row</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs9', 15)" onmouseover="showTip(event, 'fs9', 15)" class="id">GetColumn</span> <span class="s">&quot;Date&quot;</span><span class="pn">)</span>
</code></pre></td>
</tr>
</table>
<p>Note that unlike <code>CsvProvider</code>, <code>CsvFile</code> works in streaming mode for performance reasons, which means
that <code>Rows</code> can only be iterated once. If you need to iterate multiple times, use the <code>Cache</code> method,
but please note that this will increase memory usage and should not be used in large datasets.</p>
<h2>Using CSV extensions</h2>
<p>Now we look at a number of extensions that become available after
opening the <code>FSharp.Data.CsvExtensions</code> namespace. Once opened, we can write:</p>
<ul>
<li>
<code>row?column</code> uses the dynamic operator to obtain the column value named <code>column</code>;
alternatively, you can also use an indexer <code>row.[column]</code>.
</li>
<li><code>value.AsBoolean()</code> returns the value as boolean if it is either <code>true</code> or <code>false</code></li>
<li>
<code>value.AsInteger()</code> returns the value as integer if it is numeric and can be
converted to an integer; <code>value.AsInteger64()</code>, <code>value.AsDecimal()</code> and
<code>value.AsFloat()</code> behave similarly.
</li>
<li>
<code>value.AsDateTime()</code> returns the value as a <code>DateTime</code> value using either the
<a href="http://en.wikipedia.org/wiki/ISO_8601">ISO 8601</a> format, or using the
<code>\/Date(...)\/</code> JSON format containing number of milliseconds since 1/1/1970.
</li>
<li>
<code>value.AsDateTimeOffset()</code> parses the string as a <code>DateTimeOffset</code> value using either the
<a href="http://en.wikipedia.org/wiki/ISO_8601">ISO 8601</a> format, or using the
<code>\/Date(...[+/-]offset)\/</code> JSON format containing number of milliseconds since 1/1/1970,
[+/-] the 4 digit offset. Example- <code>\/Date(1231456+1000)\/</code>.
</li>
<li><code>value.AsTimeSpan()</code> parses the string as a <code>TimeSpan</code> value.</li>
<li><code>value.AsGuid()</code> returns the value as a <code>Guid</code> value.</li>
</ul>
<p>Methods that may need to parse a numeric value or date (such as <code>AsFloat</code> and
<code>AsDateTime</code>) receive an optional culture parameter.</p>
<p>The following example shows how to process the sample previous CSV sample using these extensions:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="k">open</span> <span onmouseout="hideTip(event, 'fs1', 16)" onmouseover="showTip(event, 'fs1', 16)" class="id">FSharp</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs2', 17)" onmouseover="showTip(event, 'fs2', 17)" class="id">Data</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs10', 18)" onmouseover="showTip(event, 'fs10', 18)" class="id">CsvExtensions</span>

<span class="k">for</span> <span onmouseout="hideTip(event, 'fs6', 19)" onmouseover="showTip(event, 'fs6', 19)" class="id">row</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs3', 20)" onmouseover="showTip(event, 'fs3', 20)" class="id">msft</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs7', 21)" onmouseover="showTip(event, 'fs7', 21)" class="id">Rows</span> <span class="k">do</span>
  <span onmouseout="hideTip(event, 'fs8', 22)" onmouseover="showTip(event, 'fs8', 22)" class="fn">printfn</span> <span class="s">&quot;HLOC: (</span><span class="pf">%f</span><span class="s">, </span><span class="pf">%M</span><span class="s">, </span><span class="pf">%O</span><span class="s">)&quot;</span> 
    <span class="pn">(</span><span onmouseout="hideTip(event, 'fs6', 23)" onmouseover="showTip(event, 'fs6', 23)" class="fn">row</span><span class="pn">.</span><span class="pn">[</span><span class="s">&quot;High&quot;</span><span class="pn">]</span><span class="pn">.</span><span class="id">AsFloat</span><span class="pn">(</span><span class="pn">)</span><span class="pn">)</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs6', 24)" onmouseover="showTip(event, 'fs6', 24)" class="fn">row</span><span class="o">?</span><span class="id">Low</span><span class="pn">.</span><span class="id">AsDecimal</span><span class="pn">(</span><span class="pn">)</span><span class="pn">)</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs6', 25)" onmouseover="showTip(event, 'fs6', 25)" class="fn">row</span><span class="o">?</span><span class="id">Date</span><span class="pn">.</span><span class="id">AsDateTime</span><span class="pn">(</span><span class="pn">)</span><span class="pn">)</span>
</code></pre></td>
</tr>
</table>
<h2>Transforming CSV files</h2>
<p>In addition to reading, <code>CsvFiles</code> also has support for transforming CSV files. The operations
available are <code>Filter</code>, <code>Take</code>, <code>TakeWhile</code>, <code>Skip</code>, <code>SkipWhile</code>, and <code>Truncate</code>. After transforming
you can save the results by using one of the overloads of the <code>Save</code> method. You can choose different
separator and quote characters when saving.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// Saving the first 10 stock prices where the closing price is higher than the opening price in TSV format:</span>
<span onmouseout="hideTip(event, 'fs3', 26)" onmouseover="showTip(event, 'fs3', 26)" class="fn">msft</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs11', 27)" onmouseover="showTip(event, 'fs11', 27)" class="id">Filter</span><span class="pn">(</span><span class="k">fun</span> <span onmouseout="hideTip(event, 'fs6', 28)" onmouseover="showTip(event, 'fs6', 28)" class="id">row</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs6', 29)" onmouseover="showTip(event, 'fs6', 29)" class="fn">row</span><span class="o">?</span><span class="id">Close</span><span class="pn">.</span><span class="id">AsFloat</span><span class="pn">(</span><span class="pn">)</span> <span class="o">&gt;</span> <span onmouseout="hideTip(event, 'fs6', 30)" onmouseover="showTip(event, 'fs6', 30)" class="fn">row</span><span class="o">?</span><span class="id">Open</span><span class="pn">.</span><span class="id">AsFloat</span><span class="pn">(</span><span class="pn">)</span><span class="pn">)</span>
    <span class="pn">.</span><span class="id">Truncate</span><span class="pn">(</span><span class="n">10</span><span class="pn">)</span>
    <span class="pn">.</span><span class="id">SaveToString</span><span class="pn">(</span><span class="s">&#39;\t&#39;</span><span class="pn">)</span>
</code></pre></td>
</tr>
</table>
<h2>Related articles</h2>
<ul>
<li>
<a href="CsvProvider.html">F# Data: CSV Type Provider</a> - discusses F# type provider
that provides type-safe access to CSV data
</li>
<li><a href="../reference/fsharp-data-csvfile.html">API Reference: CsvFile class</a></li>
<li><a href="../reference/fsharp-data-csvrow.html">API Reference: CsvRow class</a></li>
<li><a href="../reference/fsharp-data-csvextensions.html">API Reference: CsvExtensions module</a></li>
</ul>

<div class="tip" id="fs1">Multiple items<br />namespace FSharp<br /><br />--------------------<br />namespace Microsoft.FSharp</div>
<div class="tip" id="fs2">Multiple items<br />namespace FSharp.Data<br /><br />--------------------<br />namespace Microsoft.FSharp.Data</div>
<div class="tip" id="fs3">val msft : Runtime.CsvFile&lt;CsvRow&gt;</div>
<div class="tip" id="fs4">Multiple items<br />module CsvFile<br /><br />--------------------<br />type CsvFile =<br />&#160;&#160;inherit CsvFile&lt;CsvRow&gt;<br />&#160;&#160;private new : readerFunc:Func&lt;TextReader&gt; * ?separators:string * ?quote:char * ?hasHeaders:bool * ?ignoreErrors:bool * ?skipRows:int -&gt; CsvFile<br />&#160;&#160;member GetColumnIndex : columnName:string -&gt; int<br />&#160;&#160;member TryGetColumnIndex : columnName:string -&gt; int option<br />&#160;&#160;static member AsyncLoad : uri:string * ?separators:string * ?quote:char * ?hasHeaders:bool * ?ignoreErrors:bool * ?skipRows:int * ?encoding:Encoding -&gt; Async&lt;CsvFile&gt;<br />&#160;&#160;static member Load : reader:TextReader * ?separators:string * ?quote:char * ?hasHeaders:bool * ?ignoreErrors:bool * ?skipRows:int -&gt; CsvFile<br />&#160;&#160;static member Load : stream:Stream * ?separators:string * ?quote:char * ?hasHeaders:bool * ?ignoreErrors:bool * ?skipRows:int -&gt; CsvFile<br />&#160;&#160;static member Load : uri:string * ?separators:string * ?quote:char * ?hasHeaders:bool * ?ignoreErrors:bool * ?skipRows:int * ?encoding:Encoding -&gt; CsvFile<br />&#160;&#160;static member Parse : text:string * ?separators:string * ?quote:char * ?hasHeaders:bool * ?ignoreErrors:bool * ?skipRows:int -&gt; CsvFile</div>
<div class="tip" id="fs5">static member CsvFile.Load : reader:System.IO.TextReader * ?separators:string * ?quote:char * ?hasHeaders:bool * ?ignoreErrors:bool * ?skipRows:int -&gt; CsvFile<br />static member CsvFile.Load : stream:System.IO.Stream * ?separators:string * ?quote:char * ?hasHeaders:bool * ?ignoreErrors:bool * ?skipRows:int -&gt; CsvFile<br />static member CsvFile.Load : uri:string * ?separators:string * ?quote:char * ?hasHeaders:bool * ?ignoreErrors:bool * ?skipRows:int * ?encoding:System.Text.Encoding -&gt; CsvFile</div>
<div class="tip" id="fs6">val row : CsvRow</div>
<div class="tip" id="fs7">property Runtime.CsvFile.Rows: seq&lt;CsvRow&gt;</div>
<div class="tip" id="fs8">val printfn : format:Printf.TextWriterFormat&lt;&#39;T&gt; -&gt; &#39;T</div>
<div class="tip" id="fs9">member CsvRow.GetColumn : columnName:string -&gt; string<br />member CsvRow.GetColumn : index:int -&gt; string</div>
<div class="tip" id="fs10">module CsvExtensions<br /><br />from FSharp.Data</div>
<div class="tip" id="fs11">member Runtime.CsvFile.Filter : predicate:System.Func&lt;&#39;RowType,bool&gt; -&gt; Runtime.CsvFile&lt;&#39;RowType&gt;</div>

        </div>
        <div class="span3">
          <a href="/FSharp.Data/index.html">
            <img src="/FSharp.Data/images/logo.png" style="width:140px;height:140px;margin:10px 0px 0px 35px;border-style:none;" />
          </a>

          <ul class="nav nav-list" id="menu">

            <li class="nav-header">
              <a href="/FSharp.Data/ja/index.html" class="nflag"><img src="/FSharp.Data/images/ja.png" /></a>
              <a href="/FSharp.Data/index.html" class="nflag nflag2"><img src="/FSharp.Data/images/en.png" /></a>
              F# Data
            </li>

            <li class="divider"></li>

            <li><a href="https://nuget.org/packages/FSharp.Data"><img src="http://img.shields.io/nuget/v/FSharp.Data.svg?style=flat" /></a></li>
            <li><a href="http://github.com/fsharp/FSharp.Data">Source Code on GitHub</a></li>
            <li><a href="http://github.com/fsharp/FSharp.Data/blob/master/LICENSE.md">License (Apache 2.0)</a></li>
            <li><a href="http://github.com/fsharp/FSharp.Data/blob/master/RELEASE_NOTES.md">Release Notes</a></li>
            <li><a href="http://github.com/fsharp/FSharp.Data/blob/master/CONTRIBUTING.md">Contributing to F# Data</a></li>
            
            <li class="nav-header">Documentation</li>

            <li><a href="/FSharp.Data/index.html">Introduction</a></li>

            <li class="divider"></li>

            <li><a href="/FSharp.Data/library/CsvProvider.html">CSV Type Provider</a></li>
            <li><a href="/FSharp.Data/library/HtmlProvider.html">HTML Type Provider</a></li>
            <li><a href="/FSharp.Data/library/JsonProvider.html">JSON Type Provider</a></li>
            <li><a href="/FSharp.Data/library/XmlProvider.html">XML Type Provider</a></li>
            <li><a href="/FSharp.Data/library/WorldBank.html">WorldBank Provider</a></li>

            <li class="divider"></li>

            <li><a href="/FSharp.Data/library/Http.html">HTTP Utilities</a></li>
            <li><a href="/FSharp.Data/library/CsvFile.html">CSV Parser</a></li>
            <li><a href="/FSharp.Data/library/HtmlParser.html">HTML Parser</a></li>
            <li><a href="/FSharp.Data/library/HtmlCssSelectors.html">HTML CSS Selectors</a></li>
            <li><a href="/FSharp.Data/library/JsonValue.html">JSON Parser</a></li>

            <li class="nav-header">Tutorials</li>

            <li><a href="/FSharp.Data/tutorials/JsonToXml.html">Converting between JSON and XML</a></li>
            <li><a href="/FSharp.Data/tutorials/JsonAnonymizer.html">Anonymizing JSON</a></li>

            <li class="nav-header">Reference</li>

            <li><a href="/FSharp.Data/reference/index.html">API Reference</a></li>
          </ul>
        </div>
      </div>
    </div>
    <a href="http://github.com/fsharp/FSharp.Data"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"></a>
  </body>
  </html>